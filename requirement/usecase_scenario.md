# Usecase Scenario

<style>
h1 {
  border: none;
}
h2 {
  border-top: 1px solid #ccc;
  margin-top: 2em;
  padding-top: 1em;
}
}
</style>

## 管理ページへのログイン

システム管理者（ClockWise）の担当者がログインページにアクセスし、ログインIDとパスワードを入力して、ログインボタンをクリックする。
ログインIDとパスワードは事前に用意されたものを利用する。（ログインIDとパスワードはDBに直接SQLでレコード追加することを想定）

## システムからの通知を設定する

システムメンテナンスや障害情報をシステム利用者にお知らせする機能。
システム管理者はシステムにログイン後、お知らせの追加をクリックする。
以下の項目を入力し、追加ボタンをクリックする。

- 公開日
- 件名
- 内容

公開日に設定した日付をすぎると、システムの利用者がログイン後のトップページに通知が表示される。

## 代理店のアカウントを作成

システム管理者がシステムにログインし、代理店アカウント作成のボタンをクリックする。すると以下のような入力フォームが表示されるので、必要事項を入力後、追加をクリック。

- 会社名
- 電話番号
- ログイン名（任意のログイン名をシステム管理者に設定する。システム上重複は許さないログイン）
- メールアドレス

追加完了画面に自動生成された初期パスワードが表示される。この初期パスワードをメール等で代理店に送付する。


## 代理店のアカウント情報の変更

システム管理者がシステムにログインし、代理店一覧よりリセット対象の編集ボタンをクリックする。
フォームが表示されるので、項目を変更し保存ボタンをクリックする。

## 販売代理店ページへのログイン

販売代理店ページへアクセスし、ClockWiseから送付されたログインID（メールアドレスはログインIDとして使用しない）と初期パスワードを入力して、ログインボタンをクリックする。本パスワード設定の画面が表示されるので、パスワードを入力し、設定をクリックする。その後、ログイン画面が再度表示されるので、ログインIDと再設定したパスワードを入力し、ログインボタンをクリックする。

## TSPアカウント作成・編集・削除

販売代理店ページへログイン後、TSPアカウントの作成ボタンをクリックする。
すると以下のような入力フォームが表示されるので、必要事項を入力後、追加をクリック。

- 企業名
- 代表者名
- 所在地
- 登録番号
- 電話番号
- ログインID（任意のログインIDを販売代理店が決める。ログインIDは、TSP、TSM、クルーで重複しないもの）
- メールアドレス（オプション。ログインIDにはしない）

追加完了画面に以下のようにログイン用URL、初期自動生成されたパスワードが表示される。
この情報をメール等で運送サービス・プロバイダーの担当者宛に送付する。

```
ログイン用URL: https://keikaru.com/asty
管理者ログインID: asty   
初期パスワード: Axa343JFe
```

ログイン用URLはTSPアカウントのユーザーIDが付与されたもの。
TSP、TSM、クルーとも同じログイン用URLでログインが可能。


## TSPの各種設定

TSPがシステムにログインし、設定ボタンをクリックする。
すると以下のような設定項目の入力欄が表示されるので、必要事項を入力し、設定ボタンをクリックする。

- シスト提出の締め切り日
（たとえば、毎月10日までにクルーにシフト希望の提出をしてもらう場合は、10と入力する。）

## TSMアカウントを作成・編集・削除

TSPがシステムにログインし、運送サービスマネージャー一覧にて新規追加ボタンをクリックすると以下のような入力フォームが表示される。必要事項を入力し、追加ボタンをクリックする。

- 氏名
- ログインID（任意のログインIDを指定する。TSP、TSM、クルー全体でログインIDの重複は許さない）
- メールアドレス（オプション）

追加ボタンをクリックすると、ログイン用URL、ログインID、パスワードが表示されるので、TSP担当者は何らかの方法でこれらの情報をTSMに伝える。

```
ログイン用URL: https://keikaru.com/asty
管理者ログインID: sato
パスワード: A44a343JFe
```

## 代理店アカウントのパスワードリセット

代理店の担当者がパスワードを忘れた場合、システム管理者に連絡する。
システム管理者は代理店アカウントの一覧ボタンをクリックし、該当するアカウントのパスワードリセットボタンをクリックする。初期パスワードが表示されるので、それを代理店の担当者に連絡する。

## 元請け企業の追加・編集

TSPアカウントでログイン後、元請け企業の追加ボタンをクリックする。
以下の必要事項を入力し、追加をクリック。

- 請求書の利用する情報
  - 企業名
  - 請求書の宛名
  - 住所
  - 担当者
- シフトの集計に利用する情報
  - 倉庫の所在エリア
  - 日当（請求用）
  - 日当（クルー支払い用）
  - 個建て単価（請求用）
  - 個建て単価（支払い用）
  - 個建ての名称

## TSPの銀行情報を入力

TSPアカウントでログイン後、銀行情報のボタンをクリックする。入力フォームが表示されるので、元請け企業向けに請求書に記載するTSPの銀行情報を入力する。
入力する項目は以下の通り。

- 銀行名
- 支店名
- 支店番号
- 口座の種類
- 口座番号
- 口座名


企業
  倉庫所在地*
    日当
    個建て*
      個建ての名称*

## 運送サービスプロバイダーページへのログイン

販売代理店ページへアクセスし、ClockWiseから送付されたログインID（メールアドレス？）と初期パスワードを入力して、ログインボタンをクリックする。本パスワード設定の画面が表示されるので、パスワードを入力し、設定をクリックする。その後、ログイン画面が再度表示されるので、ログインIDと再設定したパスワードを入力し、ログインボタンをクリックする。

## TSPアカウントのパスワードリセット

TSPがもしパスワードを忘れたら販売代理店に連絡をする。
販売代理店はTSPアカウントの一覧ボタンをクリックし、該当するTSPアカウントのパスワードリセットボタンをクリックする。初期パスワードが表示されるので、それをTSPの担当者に連絡する。

## TSMアカウントのパスワードリセット

TSPはTSMアカウントの一覧ボタンをクリックし、該当するアカウントのパスワードリセットボタンをクリックする。パスワードがリセットされ新しいパスワードが表示されるので、それをTSMに連絡する。

## 運送サービスマネージャーページへのログイン

TSMのログインページにアクセスし、TSPから受け取ったアカウト名とパスワードを入力し、ログインボタンをクリックする。

## 支払い通知書の発行

TSMがシステムにログインし、支払い通知書一覧のボタンをクリック後、各クルーに行に表示されている支払通知書の発行ボタンをクリックする。

支払い通知書のプレビュー画面が表示される。追加項目があれば追加する。
また前月の項目をコピーするボタンをクリックすると、前月の支払い通知書の追加項目が当月のものにコピーされる。
保存ボタンをクリックすると、支払い通知書が保存される。
問題がなければ送信ボタンをクリックする。
送信されると、クルー側に通知が届く。

支払い通知書のカラムのステータスは以下のようになる。

- 発行
- 保存済み（通知書が保存されるとこのステータス）
- 送信済み（通知書が送信済みのステータス）
- 承認済み（通知書がクルーにより承認されたあとのステータス）
- 入金済み（TSMがクルーに支払ったあとに表示されるステータス）

もし、送信済みの通知書を修正したい場合は、閲覧ボタンをクリック後、編集ボタンをクリックする。
必要事項を修正後、保存ボタンをクリックする。保存後は送信ボタンが有効になる。

前の月の通知書を閲覧したい場合は、クルー一覧の上部に年月の入力欄があるので、そこに年月を指定すれば表示内容を変更できる。

## クルーのアカウントを作成・編集・削除

TSMがシステムにログインし、クルーボタンをクリックするとクルーの一覧が表示される。
追加ボタンをクリックする。フォームが表示されるので、以下の項目を入力する。

- 氏名
- ログインID
- 担当企業（＝元請け企業）
  - 日当 or 個建て
- 最大休暇日数（月ごとのシフト作成の際、月内に設定できる最大の休暇日数。有能なクルーには休暇の日数を増やして、余裕をもったスケジュール設定をさせたいという意図があるようだ。）
- 郵便番号
- 住所
- 登録番号（インボイス制度用）
- 電話番号
- 銀行名
- 支店コード
- 口座名
- 口座番号
- 口座種別

新規追加ボタンをクリックすると、以下のようにログインURL、ユーザー名、パスワードが表示されるので、TSM担当者は何らかの方法でこれらの情報をクルーに伝える。

```
ログインURL: https://keikaru.com/asty
ログインID: suzuki
パスワード: Huji87HJK
```



クルー一覧より編集ボタンをクリックすると、該当するクルーの情報を編集できる。
また削除ボタンをクリックすると、クルーが削除される。
（ただし、実際システムから削除されるわけではなく、「削除済みクルー」ボタンより表示できる）

## クルーのパスワードリセット

TSMはクルーアカウントの一覧ボタンをクリックし、該当するアカウントのパスワードリセットボタンをクリックする。パスワードがリセットされ新しいパスワードが表示されるので、それをクルーに連絡する。

## シフト種別の追加

TSMがシステムにログインし、シフト種別追加のボタンをクリック。
（デフォルトでは、シフト種別として「出勤」「休み」「欠勤」は固定されており、追加でシフト（「研修」など）を設定したいときに利用する。）
シフト種別名を入力し、追加ボタンをクリックする。

## クルーページへのログイン

クルーのログインページにアクセスし、TSMから受け取ったアカウト名とパスワードを入力し、ログインボタンをクリックする。

シフト希望日入力の締切日のメッセージを表示する。
もし、シフト希望日入力の締切日をすぎていた場合は、警告メッセージを表示する。

（アスティさんでは、前月の10日までにシフトの希望日をクルーに登録してもらうようにしている）

支払い通知書の一覧が表示され、もし未承認のものがあれば「確認する」のボタンが表示される。
ボタンをクリックすると、支払い通知書の詳細が表示され、内容に問題がなければ「承認する」ボタンをクリックする。
もし、問題があれば、クルーはTSMに連絡を取る。

## クルーの請求書関連情報を入力

クルーアカウントでログイン後、設定ボタンをクリックする。入力フォームが表示されるので、TSP宛の請求書に関連する情報を入力する。
入力する項目は以下の通り。

- 郵便番号
- 住所
- 電話番号
- 登録番号
- 銀行名
- 支店名
- 支店番号
- 口座の種類
- 口座番号
- 口座名

## 出退勤を入力

### 出勤時
クルーがシステムにログインする。すると、今日の日付と時刻、出勤、退勤ボタン（出勤時はボタンは無効）が表示されるので、出勤ボタンをクリックする。何らかのメッセージが表示される。

### 退勤時
クルーがシステムにログインする。すると、今日の日付と時刻、出勤（退勤時は無効化）、退勤ボタンが表示されるので、退勤ボタンをクリックする。何らかのメッセージが表示される。ボタンクリック後は、出勤、退勤ボタンがいずれも無効になる。

## シフトの入力

クルーがシステムにログインし、シスト入力のボタンをクリックする。
年月選択のリストボックスが表示されるので、シフトの入力対象の月を選択する。
対象月のすべての日に対して出勤・休みにするかを選択する。また必要に応じてメモを入力する。
入力完了後、確定送信をクリックする。送信完了後は、シフトの内容を変更することはできない。

（実際の運用では、多めに出勤日を登録して、その後の調整で休みが増えることもある。シフト希望の入力時に余裕のある
スケジュールを入力してもらう運用。TSPごとにこの最大日数を設定できる機能を用意する）

現状でのシフト決定までのフロー
1. クルーが出勤できる日、休みたい日をカレンダーに入力
2. 届いたシスト希望を元にAstyさんがシフトを調整し、Excelを作成
3. ExcelをクルーがLINE上で確認
4. 元請け企業向けには、そのExcelを加工して送付

TODO: アスティさんではシフトの詳細調整をエクセルで行っている。そのサンプルがほしい。
TODO: シフト一覧も元請け企業に提出している。
TODO: CSVやExcel出力もあったほうがよい？


<!-- ## シフトの変更依頼

→ この機能はとりあえず実装しない。

クルーがシステムにログインし、シスト入力のボタンをクリックする。
確定後の月を選択し、出勤・休暇を変更したい日にちの「変更依頼」ボタンをクリックし、希望の予定を選択して
送信ボタンをクリックする。

出勤
休暇
欠勤
研修

運送サービスマネージャー宛に通知が送付される。（メールで通知、SMSで通知、あるいはダッシュボードに表示されるだけ？？要検討）

TOOD: 変更依頼がTSMに承認されたら何らかの形で通知がクルーに届いた方がよい。どのように通知するかは要検討。 -->

<!-- ## TSM宛の請求書を作成

クルーがシステムにログインし、請求書の作成をクリックする。
請求書を作成したい年月を選択すると、請求書明細が表示される。
請求書の内容に問題がなければ、送信ボタンをクリックする。
送信済みの請求書はPDFでダウンロードできる。

TSM側では何らかの形で請求書の送付された通知が届く。

TODO: 今回はクルーから請求書を送付する形を考えているが、TSM側が支払い対象日数や個建件数の実績値を
入力し、その数値をもとに最終的な請求金額を決めるのであれば、TSM側から支払い通知を作成する方式の方が
しっくりくるかも？？要確認
→ 支払い通知書を発行する方法を採用 -->

## 配達実績の入力

クルーがシステムにログインし、個建配達実績のセクションに各倉庫・品目ごとの配達実績の入力欄があるので、個建て配達が完了したら数値を入力し、保存ボタンをクリックする。
（UIとしては、個数を入力し保存しないと退勤ボタンが押せない仕様でもよいかも）

## 元請け宛への請求書の表示（共有リンク）

TSMから前月の請求メールが元請け企業に届くと、元請け企業の担当者はメール内のリンクをクリックする。
クリックすると、請求書が表示されるので、ダウンロードすることができる。

## 元請け宛への請求書の作成

TSMがシステムにログインし、元請請求ボタンをクリックする。
請求したい元請け企業と年月を選択し表示をクリックする。
元請け企業一覧が表示されており、請求書を作成したい企業の行の「請求書発行」ボタンをクリックする。
すると、請求書の明細が表示されるので、内容を確認し以下の項目を入力後、保存をクリックする。

- 担当者（デフォルト値が入力されている）
- 請求日
- 納付期限
- 備考
- 追加明細

PDFで保存したい場合は、「PDFをダウンロード」をクリックする。

## 元請け宛への請求書の共有リンクの作成

元請け宛への請求書の詳細を表示し、「PDFの共有」ボタンをクリックするとURLが生成され表示される。

## TSM・TSP用のダッシュボードを表示

TSMがシステムにログインするとダッシュボードが表示される。
ダッシュボードには以下の内容が表示されている。

- クルー出退勤情報  
  - クルー名、出勤時刻、退勤時刻が表示される。休みの場合は、例えば「休」と表示され、出退勤の時刻は表示されない
- 通知（各項目にはリンクがあり該当するページに遷移する）
  - 「クルーXXXXからシフト変更が申請されました」
  - 「クルーXXXXから請求書が送付されました」
  - 「クルーXXXXから支払い通知書が承認されました」
  - 「クルーXXXXが2023年1月のシフトを入力していません」
- システムからの通知（ログイン直後にポップアップで表示）
  - 「システムメンテナンスのためxxx月xx日01:00〜02:00までログインいただけません」

他には請求書情報の一覧をダッシュボードに表示したり、表示項目をカスタマイズするような
機能もありかも。


## クルーからの請求書一覧を表示

TSMがシステムにログインし、請求書（クルー）ボタンをクリックすると、クルーから届いている
請求書の一覧（未払いの請求書のみ？）が表示される。

各レコードに支払い済みかどうかのチェックボックス（スイッチ？）があり、支払い済みであれば済みに変更する。

## 出勤表の表示と変更

TSMがシステムにログインし、出勤表をクリックすると当月の各クルーのシフト情報が表示される。
必要に応じて各クルーの出勤・休みのステータスを変更し、更新ボタンをクリックする。
（変更対象となったクルーには何らかの方法で通知が必要か？要検討。アスティさんは出勤表の調整はExcelで管理し、確定の通知等はクLINEグループで行っているとのこと。システムにどうこの作業を組み込むかは要検討。）

PDFのダウンロードボタンをクリックすると、出勤表をダウンロードできる。